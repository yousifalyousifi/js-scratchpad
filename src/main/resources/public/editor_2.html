<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>JS Scratchpad</title>
        <link href="css/bootstrap.4.0.0.min.cyborg.css" rel="stylesheet">
        <link href="css/scratchpad.css" rel="stylesheet" media="screen">
    </head>
    <body>
      
        <nav class="navbar navbar-expand-sm navbar-dark bg-dark">
            <a class="navbar-brand" href="#">JS Scratchpad</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li id="runButton" title="Ctrl+R" class="nav-item">
                        <a class="nav-link" href="#">Run</a>
                    </li>
                    <li id="clearButton" class="nav-item">
                        <a class="nav-link" href="#">Clear</a>
                    </li>
                    <li id="p5RefButton" class="nav-item">
                        <a class="nav-link" href="#">Reference</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="snippetsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Snippets
                        </a>
                        <div class="dropdown-menu" aria-labelledby="snippetsDropdown">
                            <a id="loadButton" class="dropdown-item" href="#" data-toggle="modal" data-target="#myModal">Snippets</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="viewDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            View
                        </a>
                        <div class="dropdown-menu" aria-labelledby="viewDropdown">
                            <a id="font14px" class="dropdown-item" href="#">14px</a>
                            <a id="font18px" class="dropdown-item" href="#">18px</a>
                            <a id="font24px" class="dropdown-item" href="#">24px</a>
                            <div class="dropdown-divider"></div>
                            <div id="ratioButtons" class="btn-group btn-group-toggle" data-toggle="buttons">
                              <label class="btn btn-sm btn-secondary">
                                <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAUCAYAAADskT9PAAAAMUlEQVR42mM4fvz4/4HEDIPGAQx4ADFqSAWjDhh1wKgDRh0w6oBRB4w6YPA5YMS2iAA4TemfUvBlyAAAAABJRU5ErkJggg==" alt="20 80"/>
                                <input type="radio" name="options" id="option1" checked>
                              </label>
                              <label class="btn btn-sm btn-secondary active">
                                <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAUCAYAAADskT9PAAAAMElEQVR42mM4fvz4/4HEDIPGAQxkAKroHXXAqANGHTDqgFEHjDpg1AGDxgEjtkUEADu36Z/FDLVCAAAAAElFTkSuQmCC" alt="50 50"/>
                                <input type="radio" name="options" id="option2">
                              </label>
                              <label class="btn btn-sm btn-secondary">
                                <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAUCAYAAADskT9PAAAANklEQVR42mM4fvz4/4HEDIPGAQxUBMSYOeqAUQeMOmDUAaMOGHXAqANo7oBjx46R5oAR2yICADum6ZzjSufRAAAAAElFTkSuQmCC" alt="80 20"/>
                                <input type="radio" name="options" id="option3"> 
                              </label>
                            </div>
                            <div class="dropdown-divider"></div>
                            <a id="wordWrap" class="dropdown-item" href="#">Enable Word Wrap</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="settingsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Settings
                        </a>
                        <div class="dropdown-menu" id="settingsCheckbox" aria-labelledby="settingsDropdown">
                          <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="autorunCheckbox">
                            <label class="form-check-label" for="autorunCheckbox">Autorun p5
                          </div>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="modeDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Mode
                        </a>
                        <div class="dropdown-menu" aria-labelledby="modeDropdown">
                            <a id="consoleMode" class="dropdown-item" href="#">Console</span></a>
                            <a id="drawMode" class="dropdown-item" href="#">Draw</a>
                        </div>
                    </li>

                    <li id="b0" class="nav-item">
                        <a class="nav-link" href="#">back step</a>
                    </li>
                    <li id="b1" class="nav-item">
                        <a class="nav-link" href="#">forward step</a>
                    </li>
                    <li id="b2" class="nav-item">
                        <a class="nav-link" href="#">stop stepping</a>
                    </li>
                    <li id="b3" class="nav-item">
                        <a class="nav-link" href="#">fill line numbers</a>
                    </li>
                    <li id="b4" class="nav-item">
                        <a class="nav-link" href="#">start auto step</a>
                    </li>
                    <li id="b5" class="nav-item">
                        <a class="nav-link" href="#">stop auto step</a>
                    </li>
                    <li id="b6" class="nav-item">
                        <a class="nav-link" href="#">restore code</a>
                    </li>
                    <li id="b7" class="nav-item">
                        <a class="nav-link" href="#">B7</a>
                    </li>
                </ul>
            </div>
        </nav>

<pre style="display: none;" id="defaultCode">
function foo(items) {
    var i;
    for (i = 0; i &lt; items.length; i++) {
        console.log("Ace Rocks " + items[i]);
    }
}


</pre>
        <div id="editorContainer">
            <pre id="editor"></pre>
        </div>
        <div id="displayContainer">
        </div>
        <script src="js/ace/ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/ace/ext-language_tools.js"></script>
        <script src="js/jquery/jquery3.2.1.js"></script>
        <script src="js/jquery/jquery.ba-throttle-debounce.min.js"></script>
        <script src="js/bootstrap/bootstrap.4.0.0.min.js"></script>
        <script src="js/acorn/acorn.js"></script>
        <script src="js/acorn/acorn_loose.js"></script>
        <script src="js/acorn/walk.js"></script>
        <script src="js/acorn/walkall.js"></script>
        <script src="js/p5/p5.js"></script>
        <script src="js/p5/addons/p5.sound.js"></script>
        <script src="js/p5/addons/p5.dom.js"></script>
        <script src="js/p5/addons/p5.func.js"></script>
        <script src="js/RateLimit.js"></script>
        <script src="js/CodeRunner.js"></script>
        <script src="js/DrawRunner.js"></script>
        <script src="js/Scratchpad.js"></script>
        <script>



var editor = ace.edit("editor");
Range = ace.require('ace/range').Range


var storedCode = window.localStorage.getItem("code");
if (storedCode) {
    editor.setValue(storedCode);
} else {
    editor.setValue($("#defaultCode").text());
}

editor.setTheme("ace/theme/monokai");
editor.session.setMode("ace/mode/javascript");
editor.setOptions({
    enableBasicAutocompletion: true,
    enableLiveAutocompletion: false
});
function monokai() {console.log('monokai!');editor.setTheme("ace/theme/monokai");}
function debugmonokai() {console.log('debugmonokai!');editor.setTheme("ace/theme/debugmonokai");}

var storedCode = window.localStorage.getItem("code");
if (storedCode) {
    editor.setValue(storedCode);
} else {editor.setValue("");}
editor.gotoLine(editor.session.getLength() + 1);
editor.commands.addCommand({
    name: 'process',
    bindKey: {
        win: 'Ctrl-F',
        mac: 'Command-F'
    },
    exec: function(editor) {
        try {
            console.log("processing.")
            window.localStorage.setItem("code", editor.getValue());
            undecoratedCode = editor.getValue();
        } catch(e) {
            console.error(e);
        }
        return false;
    },
    readOnly: false // false if this command should not apply in readOnly mode
});

window.pp = function() {
    console.log.apply(null, arguments);
};

forfeitHighlightControl = false;
stepping = false;
returnID = 0;
globalFuncCallStack = [];
GLOBAL_INDEX = 0;
fakeFrameCount = 0;
fakeMouseX = 0;
fakeMouseY = 0;
dummy = {};
returnIDFloat = 0;
infiniteLoopPresent = false;

//stepping
autostep = 1;
autoplay = null;
autointerval = 300;

//jumping
forceMultiJump = 0;
allowJump = false;


isViewingDecoratedCode = false;
decoratedCode = "";
undecoratedCode = "";

function process() {
    
    let tokens = [];
    let lines = getLines(editor.getValue());
    let postfix = " Decoration";
    
    let ast = acorn.parse(editor.getValue(), {
        ranges: true,
        locations: true,
        onToken: tokens
    });
    
    nodes = [];
    
    acorn.walk.ancestor(ast, acorn.walkall.makeVisitors(function(node, ancestors) {
        // console.log("");
        // console.log("Found node type", node.type);
        node.ancestors = [];
        for(let a of ancestors) {
            node.ancestors.push(a);
        }
        if(node.type == "ExpressionStatement") {
            processExp(node);
        }
        if(node.type == "VariableDeclaration") {
            processingVarDecl(node);
        }
        if(node.type == "BlockStatement") {
            let parent = node.ancestors[node.ancestors.length-2];
            if(parent.type == "ForInStatement" 
            || parent.type == "ForStatement"
            || parent.type == "ForOfStatement"
            || parent.type == "ForStatement"
            || parent.type == "WhileStatement"
            || parent.type == "FunctionDeclaration"
            || parent.type == "FunctionExpression") {
                processingBlockInside(node, "BLOCK");
            }
            
        }
        if(node.type =="IfStatement") {
                processingInsertBefore(node, "BLOCK");
            }
        if(node.type == "ForInStatement" 
            || node.type == "ForStatement"
            || node.type == "ForOfStatement"
            || node.type == "ForStatement"
            || node.type == "WhileStatement"
            || node.type == "FunctionDeclaration"
            || node.type == "FunctionExpression") {
            }
        // console.log(node);
        // console.log(ancestors);
        nodes.push(node);
    }), acorn.walkall.traversers);
    
    
    function processExp(exp) {
        processingInsertBefore(exp, "EXPRESSION");
    }
    
    function processingVarDecl(n) {
        processingInsertBefore(n, "VAR");
    }
    
    function processingBlockInside(node, label) {
        label = label || "UNLABELLED";
        let lineIndex = node.loc.start.line-1;
        lines[lineIndex] = lines[lineIndex].replace("pp('hi');/**"+label+" DECL"+postfix+"**/", "");
        
        let columnIndex = node.loc.start.column;
        
        let lineString = lines[lineIndex]; 
        let decoratedLine = lineString.slice(0, columnIndex+1) + "pp('hi');/**"+label+" DECL"+postfix+"**/" + lineString.slice(columnIndex+1); 
        lines[lineIndex] = decoratedLine;
    }
    
    function processingBlockOutside(node, label) {
        label = label || "UNLABELLED";
        let lineIndex = node.loc.start.line-1;
        lines[lineIndex] = lines[lineIndex].replace("pp('hi');/**"+label+" DECL"+postfix+"**/", "");
        
        let columnIndex = node.loc.start.column;
        
        let lineString = lines[lineIndex]; 
        let decoratedLine = lineString.slice(0, columnIndex) + "pp('hi');/**"+label+" DECL"+postfix+"**/" + lineString.slice(columnIndex); 
        lines[lineIndex] = decoratedLine;
    }
    
    function processingInsertBefore(node, label) {
        label = label || "UNLABELLED";
        let lineIndex = node.loc.start.line-1;
        lines[lineIndex] = lines[lineIndex].replace("pp('hi');/**"+label+" DECL"+postfix+"**/", "");
        
        let columnIndex = node.loc.start.column;
        
        let lineString = lines[lineIndex]; 
        let decoratedLine = lineString.slice(0, columnIndex) + "pp('hi');/**"+label+" DECL"+postfix+"**/" + lineString.slice(columnIndex); 
        lines[lineIndex] = decoratedLine;
    }
    
    decoratedCode = lines.join('\n');

    return nodes;
}

$("#b0").click(function(){
    if(stepping == true) {
        // returnID++;
        returnIDFloat -= 1;
        if(returnIDFloat<0) returnIDFloat = 0;
    }
    forfeitHighlightControl = true;
    pp("returnId", returnID);
    stepping = true;
});

$("#b1").click(function(){
    if(stepping == true) {
        // returnID++;
        if(allowJump) {
            returnIDFloat += forceMultiJump;
            allowJump = false;
        } else {

        returnIDFloat += 1;
        }
    }
    forfeitHighlightControl = true;
    pp("returnId", returnID);
    stepping = true;
});

$("#b2").click(function(){
    forfeitHighlightControl = false;
    stepping = false;
    returnID=0;
    if(autoplay) clearInterval(autoplay);
});

$("#b3").click(function(){
    let code = editor.getValue();
    let lines = code.split("\n");
    let newcode = [];
    for(let l = 0; l < lines.length; l++) {
        let line = lines[l];
        let newline = line.replace(/highlightLine\(\d*\)/g , "highlightLine("+(l+1)+")");
        newcode.push(newline);
    }
    let nc = newcode.join("\n");
    editor.setValue(nc);
});


$("#b4").click(function(){//start the automated i-changing via shared memory
    returnID=0;
    forfeitHighlightControl = true;
    stepping = true;
    pp("auto starting");

    allowJump = true;

    if(autoplay) clearInterval(autoplay);
    autoplay = setInterval(function() {
        // pp("auto returnId", returnID, returnID+1);
        // returnID++;
        if(allowJump) {
            returnIDFloat += forceMultiJump;
            allowJump = false;
        } else {
            returnIDFloat += autostep||1;
        }
    },autointerval||300);
});

$("#b5").click(function(){//start the automated i-changing via shared memory
    forfeitHighlightControl = false;
    stepping = false;
    if(autoplay) clearInterval(autoplay);
});

$("#b6").click(function(){
    editor.setValue(undecoratedCode);
    // let code = editor.getValue();
    // if(isViewingDecoratedCode) {
    //     console.log("undecorating");
    //     decoratedCode = code;
    //     isViewingDecoratedCode = false;
    //     editor.setValue(undecoratedCode);
    // } else {
    //     console.log("decorating");
    //     undecoratedCode = code;
        
    //     //create decorated code

    //     editor.setValue(decoratedCode);
    //     isViewingDecoratedCode = true;
    // }
});

$("#b7").click(function(){
    undecoratedCode = editor.getValue();
    editor.setValue(decoratedCode);
});

function getLines(code) {
    let result = [];
    let a = code.split('\n');
    for (let s of a) {
        result.push(s);
    }
    return result;
}

function highlightLine(lineNumber) {
    if(forfeitHighlightControl) {
        // pp("Highlighting line", lineNumber);
        let l = lineNumber-1;
        editor.selection.setRange(new Range(l, 10000, l, 0));
        // debugmonokai();
        // pp(l);
    }
}

        </script>
        <div class="modal fade" id="myModal" role="dialog" aria-labelledby="snippetsModalTitle" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header"> 
                        <h4 class="modal-title" id="snippetsModalTitle">Snippets</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <span id="snippetLoading"></span>
                    </div>
                    <div class="modal-body">
                        <div style="max-height: 300px; overflow: auto;">
                            <table class="table table-hover">
                                <thead>
                                <tr>
                                <th>Snippet Number</th>
                                <th>Snippet Title</th>
                                </tr>
                                </thead>
                                <tbody id="snippetsTableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <span id="loadingGif" style="display:none;margin-right:20px;"><img src="loading.gif"/></span>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <pre id="defaultCode" style="display:none;">
var p = 0.;
var g = new p5.Gen();
var speed = 0.01;

function setup()
{
    createCanvas(600, 600);
}

callerFlags = {};
globalFuncCallStack = [];
var i =0;
fakeFrameCount = 0;
fakeMouseX = 0;
fakeMouseY = 0;

var dummy = {};

returnIDFloat = 0;
infiniteLoopPresent = true;

function draw() {
    i =-1;
    frameCount = fakeFrameCount;
    let tempX = mouseX;
    let tempY = mouseY;
    mouseX = fakeMouseX;
    mouseY = fakeMouseY;
    try{
        randomSeed(2427436);
        background(0); 
        fill("white");
        // if(stepping&&++i>=returnID) {highlightLine(33);throw {type:"return"};}
        // text(frameCount, 120,20);
        // let size = random(50);
        // stroke(0);
        // ellipse(random(width),      random(height), 30+size, 30+size);if(stepping&&++i>=returnID) {highlightLine(37);throw {type:"return"};}
        // size = random(50);
        // ellipse(random(width),      random(height), 30+size, 30+size);if(stepping&&++i>=returnID) {highlightLine(39);throw {type:"return"};}
        // size = random(50);
        // ellipse(random(width),      random(height), 30+size, 30+size);if(stepping&&++i>=returnID) {highlightLine(41);throw {type:"return"};}
        // size = random(50);
        // ellipse(random(width),      random(height), 30+size, 30+size);if(stepping&&++i>=returnID) {highlightLine(43);throw {type:"return"};}
        // size = random(50);
        // ellipse(random(width),      random(height), 30+size, 30+size);if(stepping&&++i>=returnID) {highlightLine(45);throw {type:"return"};}
        // size = random(50);
        // ellipse(random(width),      random(height), 30+size, 30+size);if(stepping&&++i>=returnID) {highlightLine(47);throw {type:"return"};}
        
        // ellipse(mouseX, mouseY, 50,70);
        // if(stepping&&++i>=returnID) {highlightLine(50);throw {type:"return"};}if(mouseX < 200) {
        //     fill("green");ellipse(50+20,50+20, 50,70);if(stepping&&++i>=returnID) {highlightLine(51);throw {type:"return"};}
        // }
        // if(stepping&&++i>=returnID) {highlightLine(53);throw {type:"return"};}if(mouseX < 200) {
        //     fill("green");ellipse(50+25,50+25, 50,70);if(stepping&&++i>=returnID) {highlightLine(54);throw {type:"return"};}
        // }
        // if(stepping&&++i>=returnID) {highlightLine(56);throw {type:"return"};}if(mouseX < 200) {
        //     fill("green");ellipse(50+30,50+30, 50,70);if(stepping&&++i>=returnID) {highlightLine(57);throw {type:"return"};}
        // }
        // if(stepping&&++i>=returnID) {highlightLine(59);throw {type:"return"};}if(mouseX < 200) {
        //     fill("green");ellipse(50+35,50+35, 50,70);if(stepping&&++i>=returnID) {highlightLine(60);throw {type:"return"};}
        // }
        // if(stepping&&++i>=returnID) {highlightLine(62);throw {type:"return"};}if(mouseX < 200) {
        //     fill("green");ellipse(50+40,50+40, 50,70);if(stepping&&++i>=returnID) {highlightLine(63);throw {type:"return"};}
        // }
        // if(stepping&&++i>=returnID) {highlightLine(65);throw {type:"return"};}if(mouseX < 200) {
        //     fill("green");ellipse(50+45,50+45, 50,70);if(stepping&&++i>=returnID) {highlightLine(66);throw {type:"return"};}
        // }
        // if(stepping&&++i>=returnID) {highlightLine(68);throw {type:"return"};}if(mouseX < 200) {
        //     fill("green");ellipse(50+50,50+50, 50,70);if(stepping&&++i>=returnID) {highlightLine(69);throw {type:"return"};}
        // }
        // if(stepping&&++i>=returnID) {highlightLine(71);throw {type:"return"};}if(mouseX < 200) {
        //     fill("green");ellipse(50+55,50+55, 50,70);if(stepping&&++i>=returnID) {highlightLine(72);throw {type:"return"};}
        // }
        // if(stepping&&++i>=returnID) {highlightLine(74);throw {type:"return"};}if(mouseX < 200) {
        //     fill("green");ellipse(50+60,50+60, 50,70);if(stepping&&++i>=returnID) {highlightLine(75);throw {type:"return"};}
        // }
        // if(stepping&&++i>=returnID) {highlightLine(77);throw {type:"return"};}if(mouseX < 200) {
        //     fill("green");ellipse(50+65,50+65, 50,70);if(stepping&&++i>=returnID) {highlightLine(78);throw {type:"return"};}
        // }

        // if(stepping&&++i>=returnID) {highlightLine(81);throw {type:"return"};}
        // globalFuncCallStack.push({funcName:"foo",pCounter:i});
        // foo(200, 100);
        // i=globalFuncCallStack.pop().pCounter;
        

        // let d = 90;
        // if(d > 80) {
        //     fill("orange");rect(random(width), random(height), 20+random(20), 30+random(50));if(stepping&&++i>=returnID) {highlightLine(89);throw {type:"return"};}
        //     fill("red");rect(random(width), random(height), 20+random(20), 30+random(50));if(stepping&&++i>=returnID) {highlightLine(90);throw {type:"return"};}
        //     fill("blue");rect(random(width), random(height), 20+random(20), 30+random(50));if(stepping&&++i>=returnID) {highlightLine(91);throw {type:"return"};}
        //     fill("cyan");rect(random(width), random(height), 20+random(20), 30+random(50));if(stepping&&++i>=returnID) {highlightLine(92);throw {type:"return"};}
        // }
        
        // var object = dummy[(function(){if(stepping&&++i>=returnID) {highlightLine(95);throw {type:"return"};}})()] = {
        //     k: "23"+(function(){if(stepping&&++i>=returnID) {highlightLine(96);throw {type:"return"};}})()
        // }

        // if(stepping&&++i>=returnID) {highlightLine(99);throw {type:"return"};}
        // globalFuncCallStack.push({funcName:"foo",pCounter:i});
        // foo(10, 580, 5);
        // i=globalFuncCallStack.pop().pCounter;
        
        
        // for(let n = 0; n < 2; n++) {
        //     if(stepping&&++i>=returnID) {highlightLine(106);throw {type:"return"};}
        //     fill("cyan");rect(n*15+100, n*15+100, 20,20);if(stepping&&++i>=returnID) {highlightLine(107);throw {type:"return"};}
        // }
        
        let g = 0;
        stroke(0);
        scale(2);
        while(true) {
            let inf_i=i; if(stepping&&++i>=returnID) {highlightLine(114);throw {type:"return"};}
            fill(85, 141, 232);rect(g*15+75, g*15+105, 150,150);if(stepping&&++i>=returnID) {highlightLine(115);throw {type:"return"};}
            if(stepping&&++i>=returnID) {highlightLine(116);throw {type:"return"};}
            if(stepping&&++i>=returnID) {highlightLine(117);throw {type:"return"};}
            fill(126, 85, 232);rect(g*15+100, g*15+130, 150,150);if(stepping&&++i>=returnID) {highlightLine(118);throw {type:"return"};}
            if(stepping&&++i>=returnID) {highlightLine(119);throw {type:"return"};}
            if(stepping&&++i>=returnID) {highlightLine(120);throw {type:"return"};}
            
            // if(stepping&&++i>=returnID) {
            //     highlightLine(123);
            //     throw {type:"return"};
            // }
            i = inf_i;
            returnIDFloat=i+1;
            
            break;
        }
        
        fakeFrameCount++;
        fakeMouseX = tempX;
        fakeMouseY = tempY;
        if(infiniteLoopPresent) {
            returnID = Math.trunc(returnIDFloat);
        } else {
            returnID = 0;
            returnIDFloat = 0;
        }
        console.log("normal return", returnID, "  i++ ", i+1);
    }catch(e) {
        if(e.type && e.type == "return") {
            // console.log("special return", returnID, "  i++ ", i);
            returnID = Math.trunc(returnIDFloat);
        } else {
            throw e;
        }
    }
    mouseX = tempX;
    mouseY = tempY;
    // console.log("H");
}
    
function foo(x,w,recurseNum) {
    let frame = globalFuncCallStack[globalFuncCallStack.length-1];
    console.assert(frame.funcName=="foo");
    let i = frame.pCounter;
    let randDiff = random(5);
    x = width - w;
    fill(255,255,0, 10);
    strokeWeight(4);
    stroke("yellow");rect( x+random(20), 20+random(25), w-40, 80+random(25));if(stepping&&++i>=returnID) {highlightLine(163);throw {type:"return"};}
    stroke("yellow");rect( x+random(20), 20+random(25), w-40, 80+random(25));if(stepping&&++i>=returnID) {highlightLine(164);throw {type:"return"};}
    stroke("yellow");rect( x+random(20), 20+random(25), w-40, 80+random(25));if(stepping&&++i>=returnID) {highlightLine(165);throw {type:"return"};}
    stroke("yellow");rect( x+random(20), 20+random(25), w-40, 80+random(25));if(stepping&&++i>=returnID) {highlightLine(166);throw {type:"return"};}
    if(recurseNum && recurseNum > 0) {
        if(stepping&&++i>=returnID) {highlightLine(168);throw {type:"return"};}
        globalFuncCallStack.push({funcName:"foo",pCounter:i});
        foo(x+4*w/5, 4*w/5, recurseNum-1);
        i=globalFuncCallStack.pop().pCounter;
    }
    frame.pCounter = i;
}



0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
        </pre>
    </body>
</html>
